<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEAT.js ãƒ‡ãƒ¢</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        button:hover {
            background: #2980b9;
        }
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        .output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        .progress {
            width: 100%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-bar {
            height: 100%;
            background: #27ae60;
            width: 0%;
            transition: width 0.3s;
        }
        .test-result {
            display: inline-block;
            margin: 5px;
            padding: 8px 12px;
            border-radius: 4px;
            font-weight: bold;
        }
        .test-pass {
            background: #d5edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #3498db;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>ğŸ§  NEAT.js ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h1>
    
    <div class="container">
        <h2>XORå•é¡Œã®è§£æ±º</h2>
        <p>NEATã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ä½¿ã£ã¦XORï¼ˆæ’ä»–çš„è«–ç†å’Œï¼‰å•é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚</p>
        
        <button id="xor-evolve" onclick="solveXOR()">XORå•é¡Œã‚’é€²åŒ–ã§è§£æ±º</button>
        <button id="xor-test" onclick="testXOR()" disabled>è§£ã‚’è©•ä¾¡</button>
        
        <div class="progress">
            <div id="xor-progress" class="progress-bar"></div>
        </div>
        
        <div id="xor-output" class="output">é€²åŒ–ã‚’é–‹å§‹ã™ã‚‹ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„...</div>
        
        <div id="xor-results"></div>
    </div>

    <div class="container">
        <h2>é€²åŒ–çµ±è¨ˆ</h2>
        <div id="stats" class="stats">
            <div class="stat-card">
                <div class="stat-value" id="generation">-</div>
                <div class="stat-label">ä¸–ä»£</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="best-fitness">-</div>
                <div class="stat-label">æœ€é«˜é©å¿œåº¦</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avg-nodes">-</div>
                <div class="stat-label">å¹³å‡ãƒãƒ¼ãƒ‰æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avg-connections">-</div>
                <div class="stat-label">å¹³å‡æ¥ç¶šæ•°</div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>ã‚«ã‚¹ã‚¿ãƒ é©å¿œåº¦é–¢æ•°</h2>
        <p>ç•°ãªã‚‹é©å¿œåº¦é–¢æ•°ã‚’è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
        
        <button onclick="solveSineWave()">Sineæ³¢è¿‘ä¼¼</button>
        <button onclick="solveStepFunction()">ã‚¹ãƒ†ãƒƒãƒ—é–¢æ•°è¿‘ä¼¼</button>
        
        <div id="custom-output" class="output">ã‚«ã‚¹ã‚¿ãƒ å•é¡Œã‚’é¸æŠã—ã¦ãã ã•ã„...</div>
    </div>

    <script src="dist/neat.js"></script>
    <script>
        let globalNeat = new NEAT.NEAT({ seed: 42 });
        let bestGenome = null;

        function updateOutput(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent += message + '\n';
            element.scrollTop = element.scrollHeight;
        }

        function updateProgress(percentage) {
            document.getElementById('xor-progress').style.width = percentage + '%';
        }

        function updateStats(result, neat) {
            document.getElementById('generation').textContent = result.generation;
            document.getElementById('best-fitness').textContent = result.bestFitness.toFixed(4);
            
            const stats = neat.getStats(result.population);
            document.getElementById('avg-nodes').textContent = stats.averageNodes.toFixed(1);
            document.getElementById('avg-connections').textContent = stats.averageConnections.toFixed(1);
        }

        async function solveXOR() {
            const button = document.getElementById('xor-evolve');
            const testButton = document.getElementById('xor-test');
            
            button.disabled = true;
            testButton.disabled = true;
            
            document.getElementById('xor-output').textContent = '';
            updateOutput('xor-output', 'XORå•é¡Œã®é€²åŒ–ã‚’é–‹å§‹...');            const fitnessFunction = (genome) => {
                const network = globalNeat.createNetwork(genome);
                let fitness = 0;

                const testCases = [
                    { input: [0, 0], expected: 0 },
                    { input: [0, 1], expected: 1 },
                    { input: [1, 0], expected: 1 },
                    { input: [1, 1], expected: 0 }
                ];

                for (const testCase of testCases) {
                    const output = network.execute(testCase.input);
                    const error = Math.abs(output[0] - testCase.expected);
                    
                    // æ”¹è‰¯ã•ã‚ŒãŸé©å¿œåº¦è¨ˆç®—
                    if (error < 0.1) {
                        fitness += 1.0;
                    } else if (error < 0.3) {
                        fitness += 0.8;
                    } else if (error < 0.5) {
                        fitness += 0.5;
                    } else {
                        fitness += Math.max(0, 1.0 - error);
                    }
                }

                return { fitness: Math.max(0, fitness) };
            };

            try {
                const result = globalNeat.run(
                    2, 1, fitnessFunction, 
                    { 
                        ...NEAT.DEFAULT_EVOLUTION_CONFIG,
                        maxGenerations: 100, 
                        populationSize: 500 
                    }
                );

                bestGenome = result.bestGenome;
                updateProgress(100);
                updateStats(result, globalNeat);
                
                updateOutput('xor-output', `é€²åŒ–å®Œäº†!`);
                updateOutput('xor-output', `æœ€é«˜é©å¿œåº¦: ${result.bestFitness.toFixed(4)}`);
                updateOutput('xor-output', `ä¸–ä»£æ•°: ${result.generation}`);
                
                testButton.disabled = false;
            } catch (error) {
                updateOutput('xor-output', `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
            
            button.disabled = false;
        }

        function testXOR() {
            if (!bestGenome) {
                updateOutput('xor-output', 'å…ˆã«é€²åŒ–ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„');
                return;
            }

            const network = globalNeat.createNetwork(bestGenome);
            const testCases = [
                { input: [0, 0], expected: 0 },
                { input: [0, 1], expected: 1 },
                { input: [1, 0], expected: 1 },
                { input: [1, 1], expected: 0 }
            ];

            updateOutput('xor-output', '\n=== XOR ãƒ†ã‚¹ãƒˆçµæœ ===');
            
            let resultsHtml = '';
            for (const testCase of testCases) {
                const output = network.execute(testCase.input);
                const result = output[0];
                const isCorrect = Math.abs(result - testCase.expected) < 0.5;
                
                updateOutput('xor-output', 
                    `XOR(${testCase.input.join(',')}) = ${result.toFixed(4)} (æœŸå¾…å€¤: ${testCase.expected})`);
                
                resultsHtml += `<div class="test-result ${isCorrect ? 'test-pass' : 'test-fail'}">
                    ${testCase.input.join(',')} â†’ ${result.toFixed(3)}
                </div>`;
            }
            
            document.getElementById('xor-results').innerHTML = resultsHtml;
        }

        async function solveSineWave() {
            document.getElementById('custom-output').textContent = '';
            updateOutput('custom-output', 'Sineæ³¢è¿‘ä¼¼ã‚’é–‹å§‹...');

            const fitnessFunction = (genome) => {
                const network = globalNeat.createNetwork(genome);
                let error = 0;

                for (let i = 0; i < 20; i++) {
                    const x = (i / 19) * 2 * Math.PI;
                    const expected = Math.sin(x);
                    const output = network.execute([x / (2 * Math.PI)]); // æ­£è¦åŒ–
                    error += Math.abs(output[0] - expected);
                }

                return { fitness: Math.max(0, 20 - error) };
            };

            try {
                const result = globalNeat.run(
                    1, 1, fitnessFunction,
                    { maxGenerations: 50, populationSize: 30 }
                );

                updateOutput('custom-output', `Sineæ³¢è¿‘ä¼¼å®Œäº†!`);
                updateOutput('custom-output', `æœ€é«˜é©å¿œåº¦: ${result.bestFitness.toFixed(4)}`);
                
                // ãƒ†ã‚¹ãƒˆ
                const network = globalNeat.createNetwork(result.bestGenome);
                updateOutput('custom-output', '\nãƒ†ã‚¹ãƒˆçµæœ:');
                for (let i = 0; i < 5; i++) {
                    const x = (i / 4) * 2 * Math.PI;
                    const expected = Math.sin(x);
                    const output = network.execute([x / (2 * Math.PI)]);
                    updateOutput('custom-output', 
                        `sin(${x.toFixed(2)}) = ${output[0].toFixed(4)} (æœŸå¾…å€¤: ${expected.toFixed(4)})`);
                }
            } catch (error) {
                updateOutput('custom-output', `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        async function solveStepFunction() {
            document.getElementById('custom-output').textContent = '';
            updateOutput('custom-output', 'ã‚¹ãƒ†ãƒƒãƒ—é–¢æ•°è¿‘ä¼¼ã‚’é–‹å§‹...');

            const fitnessFunction = (genome) => {
                const network = globalNeat.createNetwork(genome);
                let fitness = 0;

                for (let i = 0; i < 10; i++) {
                    const x = i / 9;
                    const expected = x < 0.5 ? 0 : 1;
                    const output = network.execute([x]);
                    const error = Math.abs(output[0] - expected);
                    fitness += 1.0 - error;
                }

                return { fitness: Math.max(0, fitness) };
            };

            try {
                const result = globalNeat.run(
                    1, 1, fitnessFunction,
                    { maxGenerations: 30, populationSize: 25 }
                );

                updateOutput('custom-output', `ã‚¹ãƒ†ãƒƒãƒ—é–¢æ•°è¿‘ä¼¼å®Œäº†!`);
                updateOutput('custom-output', `æœ€é«˜é©å¿œåº¦: ${result.bestFitness.toFixed(4)}`);
                
                // ãƒ†ã‚¹ãƒˆ
                const network = globalNeat.createNetwork(result.bestGenome);
                updateOutput('custom-output', '\nãƒ†ã‚¹ãƒˆçµæœ:');
                for (let i = 0; i < 10; i++) {
                    const x = i / 9;
                    const expected = x < 0.5 ? 0 : 1;
                    const output = network.execute([x]);
                    updateOutput('custom-output', 
                        `step(${x.toFixed(2)}) = ${output[0].toFixed(4)} (æœŸå¾…å€¤: ${expected})`);
                }
            } catch (error) {
                updateOutput('custom-output', `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateOutput('xor-output', 'NEAT.js ãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸï¼');
            updateOutput('xor-output', 'NEATã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ä½¿ã£ã¦XORå•é¡Œã‚’è§£æ±ºã—ã¾ã—ã‚‡ã†ã€‚');
        });
    </script>
</body>
</html>
